const w=["Facebook Ads","SMS","unityads_int","Apple Search Ads","applovin_int","remerge_int","Email","tapjoy_int","adquant","criteo_int","googleadwords_int","ironsource_int","bytedanceglobal_int","reddit_int","twitter_int","snapchat_int","vungle_int","tiktok_int","taboola_int","appguardion_int","blindferret_int","crosstarget_int","Google"],I=["level_5_achieved","tutorial_completed","af_purchase","ad_monetized","level_10_achieved"];function g(e,n=!1){console.log("selectImage called with URL:",e,"Is custom URL:",n);const t=document.getElementById("customImagePreview");if(document.querySelectorAll(".image-option").forEach(o=>{o.style.border="none"}),n&&t)t.innerHTML=`<img src="${e}" class="preview-image">`,t.style.border="2px solid green",t.style.display="block";else{const o=document.querySelector(`.image-option[src="${e}"]`);o&&(o.style.border="2px solid green"),t&&(t.innerHTML="",t.style.display="none")}}const m=document.getElementById("customImagePreview"),p=document.getElementById("customImageUrl");function L(){console.log("Loading or setting default image"),chrome.storage.sync.get(["selectedImage","activePreset"],function(e){console.log("Loaded active preset button:",e.activePreset);const n="icons/af_icon_rainbow.png";let t=e.selectedImage||n;console.log("Selected image:",t),t.startsWith("icons/")?(g(t),p.value="",m.innerHTML="",m.style.display="none"):(p.value=t,g(t,!0)),document.querySelectorAll(".preset-button").forEach(i=>{i.classList.remove("active")});const a=e.activePreset||"button-custom",c=document.getElementById(a);console.log("Active preset button:",c),c&&c.classList.add("active")})}function T(){const e=document.createElement("div");return e.id="unsaved-changes-msg",e.innerText="Unsaved changes - make sure to save.",e}const s=T();function k(){console.log("Save button clicked");const e=[];document.querySelectorAll("#mediaSources .mapping-row, #inAppEvents .mapping-row").forEach(i=>{const l=i.querySelector(".original-text"),d=i.querySelector(".new-text"),E=i.parentElement?i.parentElement.id:"";l&&d&&e.push({section:E,original:l.value,newText:d.value})});let n;const t=document.querySelector('.image-option[style*="border: 2px solid green"]');t?n=t.getAttribute("src")||"https://web1.sa.appsflyer.com/xdash_images/af_icon_rainbow.png":p.value?n=p.value:n="https://web1.sa.appsflyer.com/xdash_images/af_icon_rainbow.png";const o=document.querySelector(".preset-button.active"),a=o?o.value:"",c=y.checked;chrome.storage.sync.set({extensionEnabled:c},()=>{console.log("Extension status saved:",c)}),chrome.storage.sync.set({mappings:e,selectedImage:n,activePreset:a},()=>{console.log("Mappings, selected image, and active preset button state saved:",e,n,a),s.innerText="Changes saved!",s.style.color="green",s.style.display="block",setTimeout(()=>{s.style.display="none"},2e3)})}function b(){s.style.display="block",s.innerText="Unsaved changes - make sure to save!",s.style.color="red"}function S(){document.querySelectorAll(".original-text, .new-text").forEach(e=>{e.removeEventListener("input",b),e.addEventListener("input",b)})}const B={"button-gaming":{iconUrl:"icons/af_icon_red.png",mappings:[{section:"inAppEvents",original:"level_5_achieved",newText:"Purchase"},{section:"inAppEvents",original:"af_purchase",newText:"Level 3 Achieved"},{section:"inAppEvents",original:"level_10_achieved",newText:"Level 10 Achieved"},{section:"inAppEvents",original:"tutorial_completed",newText:"Deposit"},{section:"inAppEvents",original:"ad_monetized",newText:"Log In"}]},"button-ecommerce":{iconUrl:"icons/af_icon_orange.png",mappings:[{section:"inAppEvents",original:"level_5_achieved",newText:"Log-in"},{section:"inAppEvents",original:"af_purchase",newText:"Purchase"},{section:"inAppEvents",original:"level_10_achieved",newText:"Add to Wishlist"},{section:"inAppEvents",original:"tutorial_completed",newText:"First Purchase"},{section:"inAppEvents",original:"ad_monetized",newText:"Loyalty Signup"}]},"button-banking":{iconUrl:"icons/af_icon_green.png",mappings:[{section:"inAppEvents",original:"level_5_achieved",newText:"Application Started"},{section:"inAppEvents",original:"af_purchase",newText:"Application Completed"},{section:"inAppEvents",original:"level_10_achieved",newText:"Application Approved"},{section:"inAppEvents",original:"tutorial_completed",newText:"First Deposit"},{section:"inAppEvents",original:"ad_monetized",newText:"Create Account"}]},"button-general":{iconUrl:"icons/af_icon_rainbow.png",mappings:[{section:"inAppEvents",original:"level_5_achieved",newText:"Create Account"},{section:"inAppEvents",original:"af_purchase",newText:"Add to Cart"},{section:"inAppEvents",original:"level_10_achieved",newText:"Purchase"},{section:"inAppEvents",original:"tutorial_completed",newText:"First Purchase"},{section:"inAppEvents",original:"ad_monetized",newText:"Booking"}]}},f="Unsaved changes - make sure to save!",u="block",h="red",P="2px solid green",C="none",M="none";function _(e,n,t){s.innerText=e,s.style.display=n,s.style.color=t}function U(e,n,t){m.innerHTML=e?`<img src="${e}" class="preview-image">`:"",m.style.border=e?t:C,m.style.display=e?n:M}function v(){const e=document.getElementById("button-custom");e==null||e.click()}function q(){console.log("Setting event listeners");const e=document.getElementById("addMediaSource"),n=document.getElementById("addInAppEvent"),t=document.getElementById("save");e.addEventListener("click",()=>r("mediaSources","","")),n.addEventListener("click",()=>r("inAppEvents","","")),t.addEventListener("click",k),y.addEventListener("change",b),p.addEventListener("input",()=>{const i=p.value||"";g(i,!!i),U(i,u,P),_(f,u,h),v()});function o(i){var E;document.querySelectorAll(".preset-button").forEach(A=>A.classList.remove("active"));const l=i.currentTarget;l.classList.add("active");const d=B[l.id];if(d){d.iconUrl&&g(d.iconUrl);const A=document.getElementById("inAppEvents");A.innerHTML="",(E=d.mappings)==null||E.forEach(x=>r(x.section,x.original,x.newText))}_(f,u,h)}document.querySelectorAll(".preset-button").forEach(i=>i.addEventListener("click",o));const c=document.getElementById("button-custom");c==null||c.classList.add("active"),document.querySelectorAll(".image-option").forEach(i=>{i.addEventListener("click",()=>{const l=i.getAttribute("src")||"";console.log("Predefined image option clicked:",l),g(l),p.value="",_(f,u,h),v()})}),document.querySelectorAll("#mediaSources input, #inAppEvents input").forEach(i=>{i.addEventListener("input",()=>{_(f,u,h),v()})})}function r(e,n,t){console.log("Adding mapping row to",e);const o=document.createElement("div"),a=document.getElementById("mediaSources"),c=document.getElementById("inAppEvents");if(!a||!c){console.error("Required elements not found in the document");return}o.className="mapping-row",o.innerHTML=`
        <input type="text" class="original-text" placeholder="Original" value="${n}">
        <input type="text" class="new-text" placeholder="Replacement" value="${t}">
        <button class="action-button remove-mapping">&#10005;</button>`,o.querySelector(".remove-mapping").addEventListener("click",()=>{o.remove(),s.innerText="Unsaved changes - make sure to save!",s.style.display="block",s.style.color="red",v()}),e==="mediaSources"?a.appendChild(o):e==="inAppEvents"&&c.appendChild(o),S()}function D(){w.forEach(e=>{r("mediaSources",e,"")}),I.forEach(e=>{r("inAppEvents",e,"")})}function O(){document.querySelectorAll(".mapping-row").forEach(e=>{e.remove()}),D(),v()}function N(){console.log("Loading existing mappings"),chrome.storage.sync.get(["mappings"],e=>{const n=e.mappings||[];n.length>0?(console.log("Saved mappings found:",n),n.forEach(t=>{r(t.section,t.original,t.newText)})):(console.log("No saved mappings found. Adding default mappings."),w.forEach(t=>{r("mediaSources",t,"")}),I.forEach(t=>{r("inAppEvents",t,"")}))})}const y=document.getElementById("extensionStatusCheckbox");document.addEventListener("DOMContentLoaded",()=>{var t;console.log("DOM fully loaded and parsed");const e=document.getElementById("saveSection"),n=document.getElementById("restoreDefaults");chrome.storage.sync.get(["extensionEnabled"],o=>{o.extensionEnabled===void 0?(chrome.storage.sync.set({extensionEnabled:!0}),y.checked=!0):y.checked=o.extensionEnabled}),n.addEventListener("click",O),(t=e.parentNode)==null||t.insertBefore(s,e),N(),L(),S(),q()});
