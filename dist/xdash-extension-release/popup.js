import{A as T}from"./analyticsHandler.js";const S=["Facebook Ads","SMS","unityads_int","Apple Search Ads","applovin_int","remerge_int","Email","tapjoy_int","adquant","criteo_int","googleadwords_int","ironsource_int","bytedanceglobal_int","reddit_int","twitter_int","snapchat_int","vungle_int","tiktok_int","taboola_int","appguardion_int","blindferret_int","crosstarget_int","Google"],w=["level_5_achieved","tutorial_completed","af_purchase","ad_monetized","level_10_achieved"];function v(t,n=!1){console.log("selectImage called with URL:",t,"Is custom URL:",n);const e=document.getElementById("customImagePreview");if(document.querySelectorAll(".image-option").forEach(o=>{o.style.border="none"}),n&&e)e.innerHTML=`<img src="${t}" class="preview-image">`,e.style.border="2px solid green",e.style.display="block";else{const o=document.querySelector(`.image-option[src="${t}"]`);o&&(o.style.border="2px solid green"),e&&(e.innerHTML="",e.style.display="none")}}const E=document.getElementById("customImagePreview"),p=document.getElementById("customImageUrl");function B(){console.log("Loading or setting default image"),chrome.storage.sync.get(["selectedImage","activePreset"],function(t){console.log("Loaded active preset button:",t.activePreset);const n="icons/af_icon_rainbow.png";let e=t.selectedImage||n;console.log("Selected image:",e),e.startsWith("icons/")?(v(e),p.value="",E.innerHTML="",E.style.display="none"):(p.value=e,v(e,!0)),document.querySelectorAll(".preset-button").forEach(i=>{i.classList.remove("active")});const a=t.activePreset||"button-custom",s=document.getElementById(a);console.log("Active preset button:",s),s&&s.classList.add("active")})}function C(){const t=document.createElement("div");return t.id="unsaved-changes-msg",t.innerText="Unsaved changes - make sure to save.",t}const c=C();function P(){console.log("Save button clicked");const t=[];document.querySelectorAll("#mediaSources .mapping-row, #inAppEvents .mapping-row").forEach(i=>{const l=i.querySelector(".original-text"),r=i.querySelector(".new-text"),y=i.parentElement?i.parentElement.id:"";l&&r&&t.push({section:y,original:l.value,newText:r.value})});let n;const e=document.querySelector('.image-option[style*="border: 2px solid green"]');e?n=e.getAttribute("src")||"https://web1.sa.appsflyer.com/xdash_images/af_icon_rainbow.png":p.value?n=p.value:n="https://web1.sa.appsflyer.com/xdash_images/af_icon_rainbow.png";const o=document.querySelector(".preset-button.active"),a=o?o.value:"",s=g.checked;chrome.storage.sync.set({extensionEnabled:s},()=>{console.log("Extension status saved:",s)}),chrome.storage.sync.set({mappings:t,selectedImage:n,activePreset:a},()=>{console.log("Mappings, selected image, and active preset button state saved:",t,n,a),c.innerText="Changes saved!",c.style.color="green",c.style.display="block",setTimeout(()=>{c.style.display="none"},2e3)})}function L(){c.style.display="block",c.innerText="Unsaved changes - make sure to save!",c.style.color="red"}function k(){document.querySelectorAll(".original-text, .new-text").forEach(t=>{t.removeEventListener("input",L),t.addEventListener("input",L)})}const M={"button-gaming":{iconUrl:"icons/af_icon_red.png",mappings:[{section:"inAppEvents",original:"level_5_achieved",newText:"Purchase"},{section:"inAppEvents",original:"af_purchase",newText:"Level 3 Achieved"},{section:"inAppEvents",original:"level_10_achieved",newText:"Level 10 Achieved"},{section:"inAppEvents",original:"tutorial_completed",newText:"Deposit"},{section:"inAppEvents",original:"ad_monetized",newText:"Log In"}]},"button-ecommerce":{iconUrl:"icons/af_icon_orange.png",mappings:[{section:"inAppEvents",original:"level_5_achieved",newText:"Log-in"},{section:"inAppEvents",original:"af_purchase",newText:"Purchase"},{section:"inAppEvents",original:"level_10_achieved",newText:"Add to Wishlist"},{section:"inAppEvents",original:"tutorial_completed",newText:"First Purchase"},{section:"inAppEvents",original:"ad_monetized",newText:"Loyalty Signup"}]},"button-banking":{iconUrl:"icons/af_icon_green.png",mappings:[{section:"inAppEvents",original:"level_5_achieved",newText:"Application Started"},{section:"inAppEvents",original:"af_purchase",newText:"Application Completed"},{section:"inAppEvents",original:"level_10_achieved",newText:"Application Approved"},{section:"inAppEvents",original:"tutorial_completed",newText:"First Deposit"},{section:"inAppEvents",original:"ad_monetized",newText:"Create Account"}]},"button-general":{iconUrl:"icons/af_icon_rainbow.png",mappings:[{section:"inAppEvents",original:"level_5_achieved",newText:"Create Account"},{section:"inAppEvents",original:"af_purchase",newText:"Add to Cart"},{section:"inAppEvents",original:"level_10_achieved",newText:"Purchase"},{section:"inAppEvents",original:"tutorial_completed",newText:"First Purchase"},{section:"inAppEvents",original:"ad_monetized",newText:"Booking"}]}},h="Unsaved changes - make sure to save!",m="block",_="red",O="2px solid green",U="none",q="none";function A(t,n,e){c.innerText=t,c.style.display=n,c.style.color=e}function D(t,n,e){E.innerHTML=t?`<img src="${t}" class="preview-image">`:"",E.style.border=t?e:U,E.style.display=t?n:q}function f(){const t=document.getElementById("button-custom");t==null||t.click()}function R(){console.log("Setting event listeners");const t=document.getElementById("addMediaSource"),n=document.getElementById("addInAppEvent"),e=document.getElementById("save");t.addEventListener("click",()=>d("mediaSources","","")),n.addEventListener("click",()=>d("inAppEvents","","")),e.addEventListener("click",P),g.addEventListener("change",L),p.addEventListener("input",()=>{const i=p.value||"";v(i,!!i),D(i,m,O),A(h,m,_),f()});function o(i){var y;document.querySelectorAll(".preset-button").forEach(x=>x.classList.remove("active"));const l=i.currentTarget;l.classList.add("active");const r=M[l.id];if(r){r.iconUrl&&v(r.iconUrl);const x=document.getElementById("inAppEvents");x.innerHTML="",(y=r.mappings)==null||y.forEach(b=>d(b.section,b.original,b.newText))}A(h,m,_)}document.querySelectorAll(".preset-button").forEach(i=>i.addEventListener("click",o));const s=document.getElementById("button-custom");s==null||s.classList.add("active"),document.querySelectorAll(".image-option").forEach(i=>{i.addEventListener("click",()=>{const l=i.getAttribute("src")||"";console.log("Predefined image option clicked:",l),v(l),p.value="",A(h,m,_),f()})}),document.querySelectorAll("#mediaSources input, #inAppEvents input").forEach(i=>{i.addEventListener("input",()=>{A(h,m,_),f()})})}function d(t,n,e){console.log("Adding mapping row to",t);const o=document.createElement("div"),a=document.getElementById("mediaSources"),s=document.getElementById("inAppEvents");if(!a||!s){console.error("Required elements not found in the document");return}o.className="mapping-row",o.innerHTML=`
        <input type="text" class="original-text" placeholder="Original" value="${n}">
        <input type="text" class="new-text" placeholder="Replacement" value="${e}">
        <button class="action-button remove-mapping">&#10005;</button>`,o.querySelector(".remove-mapping").addEventListener("click",()=>{o.remove(),c.innerText="Unsaved changes - make sure to save!",c.style.display="block",c.style.color="red",f()}),t==="mediaSources"?a.appendChild(o):t==="inAppEvents"&&s.appendChild(o),k()}function H(){S.forEach(t=>{d("mediaSources",t,"")}),w.forEach(t=>{d("inAppEvents",t,"")})}function F(){document.querySelectorAll(".mapping-row").forEach(t=>{t.remove()}),H(),f()}function N(){console.log("Loading existing mappings"),chrome.storage.sync.get(["mappings"],t=>{const n=t.mappings||[];n.length>0?(console.log("Saved mappings found:",n),n.forEach(e=>{d(e.section,e.original,e.newText)})):(console.log("No saved mappings found. Adding default mappings."),S.forEach(e=>{d("mediaSources",e,"")}),w.forEach(e=>{d("inAppEvents",e,"")}))})}class z{constructor(n){this.analyticsHandler=n}initializeOverlay(){console.log("OverlayHandler initialized");const n=document.getElementById("overlay");if(!n){console.error("Overlay element not found");return}chrome.storage.sync.get(["firstLaunch"],o=>{o.firstLaunch===void 0&&(n.style.display="flex")});const e=document.getElementById("submitOverlay");if(!e){console.error("Submit button not found");return}e.addEventListener("click",()=>{this.handleSubmit()})}handleSubmit(){const n=document.getElementById("afGmail"),e=document.getElementById("afRegion"),o=document.getElementById("afTeam");if(!n||!e||!o){console.error("One or more input elements not found");return}n.classList.remove("error");const a=n.nextElementSibling;a&&(a.textContent="");const s=n.value.trim();if(!this.validateEmail(s)){n.classList.add("error"),a&&(a.textContent="Please enter a valid AppsFlyer email address.");return}const i=e.value,l=o.value;chrome.storage.sync.set({firstLaunch:!1,afGmail:s,afRegion:i,afTeam:l,extensionEnabled:!0},()=>{this.updateExtensionEnabledCheckbox(!0)});const r=document.getElementById("overlay");r?r.style.display="none":console.error("Overlay element not found"),this.analyticsHandler.fireEvent("new_user",{afGmail:s,afRegion:i,afTeam:l})}updateExtensionEnabledCheckbox(n){const e=document.getElementById("extensionStatusCheckbox");e?e.checked=n:console.error("Extension status checkbox not found")}validateEmail(n){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)&&n.endsWith("@appsflyer.com")}}const u=new T,V=new z(u),g=document.getElementById("extensionStatusCheckbox");let I=null;function G(){g.addEventListener("change",()=>{const e=g.checked;u.fireEvent("checkbox_change",{status:e?"checked":"unchecked"}),console.log("Analytics Event Fired: Active Checkbox Status Changed")}),document.querySelectorAll(".image-option").forEach(e=>{e.addEventListener("click",()=>{const o=e.src;u.fireEvent("image_option_clicked",{imageSrc:o}),console.log("Analytics Event Fired: Image Option Clicked")})});const t=document.getElementById("customImageUrl");t.addEventListener("input",()=>{const e=t.value;u.fireEvent("custom_image_url_changed",{url:e}),console.log("Analytics Event Fired: Custom Image URL Changed")}),document.querySelectorAll(".preset-button").forEach(e=>{e.addEventListener("click",o=>{const a=o.target.id;I=a,u.fireEvent("vertical_preset_clicked",{buttonId:a}),console.log("Analytics Event Fired: Vertical Preset Clicked")})});const n=document.getElementById("save");n?n.addEventListener("click",()=>{I&&(u.fireEvent("vertical_preset_changed",{buttonId:I}),console.log("Analytics Event Fired: Vertical Preset Changed"))}):console.error("Save button not found")}document.addEventListener("DOMContentLoaded",()=>{var e;console.log("DOM fully loaded and parsed"),V.initializeOverlay();const t=document.getElementById("saveSection"),n=document.getElementById("restoreDefaults");chrome.storage.sync.get(["extensionEnabled"],o=>{o.extensionEnabled===void 0?g.checked=!1:g.checked=o.extensionEnabled}),n.addEventListener("click",F),(e=t.parentNode)==null||e.insertBefore(c,t),window.addEventListener("load",()=>{u.firePageViewEvent(document.title,document.location.href),console.log("Analytics Event Fired: Page View")}),G(),N(),B(),k(),R()});
