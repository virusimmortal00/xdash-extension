const u=["Facebook Ads","SMS","unityads_int","Apple Search Ads","applovin_int","remerge_int","Email","tapjoy_int","adquant","criteo_int","googleadwords_int","ironsource_int","bytedanceglobal_int","reddit_int","twitter_int","snapchat_int","vungle_int","tiktok_int","taboola_int","appguardion_int","blindferret_int","crosstarget_int","Google"],v=["level_5_achieved","tutorial_completed","af_purchase","ad_monetized","level_10_achieved"];function r(e,o=!1){console.log("selectImage called with URL:",e,"Is custom URL:",o);const n=document.getElementById("customImagePreview");if(document.querySelectorAll(".image-option").forEach(t=>{t.style.border="none"}),o&&n)n.innerHTML=`<img src="${e}" class="preview-image">`,n.style.border="2px solid green",n.style.display="block";else{const t=document.querySelector(`.image-option[src="${e}"]`);t&&(t.style.border="2px solid green"),n&&(n.innerHTML="",n.style.display="none")}}const i=document.getElementById("customImagePreview"),l=document.getElementById("customImageUrl");function E(){console.log("Loading or setting default image"),chrome.storage.sync.get(["selectedImage"],function(e){const o="icons/af_icon_rainbow.png";let n=e.selectedImage||o;console.log("Selected image:",n),n.startsWith("icons/")?(r(n),l.value="",i.innerHTML="",i.style.display="none"):(l.value=n,r(n,!0))})}function h(){const e=document.createElement("div");return e.id="unsaved-changes-msg",e.innerText="Unsaved changes - make sure to save.",e}const s=h();function b(){console.log("Save button clicked");const e=[];document.querySelectorAll("#mediaSources .mapping-row, #inAppEvents .mapping-row").forEach(a=>{const d=a.querySelector(".original-text"),p=a.querySelector(".new-text"),f=a.parentElement?a.parentElement.id:"";d&&p&&e.push({section:f,original:d.value,newText:p.value})});let o;const n=document.querySelector('.image-option[style*="border: 2px solid green"]');n?o=n.getAttribute("src")||"https://web1.sa.appsflyer.com/xdash_images/af_icon_rainbow.png":l.value?o=l.value:o="https://web1.sa.appsflyer.com/xdash_images/af_icon_rainbow.png";const t=g.checked;chrome.storage.sync.set({extensionEnabled:t},()=>{console.log("Extension status saved:",t)}),chrome.storage.sync.set({mappings:e,selectedImage:o},()=>{console.log("Mappings and selected image saved:",e,o),s.innerText="Changes saved!",s.style.color="green",s.style.display="block",setTimeout(()=>{s.style.display="none"},2e3)})}function m(){s.style.display="block",s.innerText="Unsaved changes - make sure to save.",s.style.color="red"}function y(){document.querySelectorAll(".original-text, .new-text").forEach(e=>{e.removeEventListener("input",m),e.addEventListener("input",m)})}function c(e,o,n){console.log("Adding mapping row to",e);const t=document.createElement("div"),a=document.getElementById("mediaSources"),d=document.getElementById("inAppEvents");if(!a||!d){console.error("Required elements not found in the document");return}t.className="mapping-row",t.innerHTML=`
        <input type="text" class="original-text" placeholder="Original" value="${o}">
        <input type="text" class="new-text" placeholder="Replacement" value="${n}">
        <button class="action-button remove-mapping">&#10005;</button>`,t.querySelector(".remove-mapping").addEventListener("click",()=>{t.remove(),s.style.display="block"}),e==="mediaSources"?a.appendChild(t):e==="inAppEvents"&&d.appendChild(t),y()}function I(){u.forEach(e=>{c("mediaSources",e,"")}),v.forEach(e=>{c("inAppEvents",e,"")})}function S(){document.querySelectorAll(".mapping-row").forEach(e=>{e.remove()}),I(),s.style.display="none"}function x(){console.log("Loading existing mappings"),chrome.storage.sync.get(["mappings"],e=>{const o=e.mappings||[];o.length>0?(console.log("Saved mappings found:",o),o.forEach(n=>{c(n.section,n.original,n.newText)})):(console.log("No saved mappings found. Adding default mappings."),u.forEach(n=>{c("mediaSources",n,"")}),v.forEach(n=>{c("inAppEvents",n,"")}))})}function _(){console.log("Setting event listeners");const e=document.getElementById("addMediaSource"),o=document.getElementById("addInAppEvent"),n=document.getElementById("save");e.addEventListener("click",()=>c("mediaSources","","")),o.addEventListener("click",()=>c("inAppEvents","","")),n.addEventListener("click",b),g.addEventListener("change",m),l.addEventListener("input",()=>{const t=l.value||"";r(t,!!t),t?(i.innerHTML=`<img src="${t}" class="preview-image">`,i.style.border="2px solid green",i.style.display="block"):(i.innerHTML="",i.style.border="none",i.style.display="none"),s.style.display="block"}),document.querySelectorAll(".image-option").forEach(t=>{t.addEventListener("click",()=>{const a=t.getAttribute("src")||"";console.log("Predefined image option clicked:",a),r(a),l.value="",s.style.display="block"})})}const g=document.getElementById("extensionStatusCheckbox");document.addEventListener("DOMContentLoaded",()=>{var n;console.log("DOM fully loaded and parsed");const e=document.getElementById("saveSection"),o=document.getElementById("restoreDefaults");chrome.storage.sync.get(["extensionEnabled"],t=>{t.extensionEnabled===void 0?(chrome.storage.sync.set({extensionEnabled:!0}),g.checked=!0):g.checked=t.extensionEnabled}),o.addEventListener("click",S),(n=e.parentNode)==null||n.insertBefore(s,e),x(),E(),y(),_()});
