const b=["Facebook Ads","SMS","unityads_int","Apple Search Ads","applovin_int","remerge_int","Email","tapjoy_int","adquant","criteo_int","googleadwords_int","ironsource_int","bytedanceglobal_int","reddit_int","twitter_int","snapchat_int","vungle_int","tiktok_int","taboola_int","appguardion_int","blindferret_int","crosstarget_int","Google"],h=["level_5_achieved","tutorial_completed","af_purchase","ad_monetized","level_10_achieved"];function p(e,n=!1){console.log("selectImage called with URL:",e,"Is custom URL:",n);const t=document.getElementById("customImagePreview");if(document.querySelectorAll(".image-option").forEach(o=>{o.style.border="none"}),n&&t)t.innerHTML=`<img src="${e}" class="preview-image">`,t.style.border="2px solid green",t.style.display="block";else{const o=document.querySelector(`.image-option[src="${e}"]`);o&&(o.style.border="2px solid green"),t&&(t.innerHTML="",t.style.display="none")}}const r=document.getElementById("customImagePreview"),g=document.getElementById("customImageUrl");function I(){console.log("Loading or setting default image"),chrome.storage.sync.get(["selectedImage","activePreset"],function(e){console.log("Loaded active preset button:",e.activePreset);const n="icons/af_icon_rainbow.png";let t=e.selectedImage||n;console.log("Selected image:",t),t.startsWith("icons/")?(p(t),g.value="",r.innerHTML="",r.style.display="none"):(g.value=t,p(t,!0)),document.querySelectorAll(".preset-button").forEach(s=>{s.classList.remove("active")});const c=e.activePreset||"button-custom",i=document.getElementById(c);console.log("Active preset button:",i),i&&i.classList.add("active")})}function S(){const e=document.createElement("div");return e.id="unsaved-changes-msg",e.innerText="Unsaved changes - make sure to save.",e}const a=S();function x(){console.log("Save button clicked");const e=[];document.querySelectorAll("#mediaSources .mapping-row, #inAppEvents .mapping-row").forEach(s=>{const l=s.querySelector(".original-text"),u=s.querySelector(".new-text"),m=s.parentElement?s.parentElement.id:"";l&&u&&e.push({section:m,original:l.value,newText:u.value})});let n;const t=document.querySelector('.image-option[style*="border: 2px solid green"]');t?n=t.getAttribute("src")||"https://web1.sa.appsflyer.com/xdash_images/af_icon_rainbow.png":g.value?n=g.value:n="https://web1.sa.appsflyer.com/xdash_images/af_icon_rainbow.png";const o=document.querySelector(".preset-button.active"),c=o?o.value:"",i=f.checked;chrome.storage.sync.set({extensionEnabled:i},()=>{console.log("Extension status saved:",i)}),chrome.storage.sync.set({mappings:e,selectedImage:n,activePreset:c},()=>{console.log("Mappings, selected image, and active preset button state saved:",e,n,c),a.innerText="Changes saved!",a.style.color="green",a.style.display="block",setTimeout(()=>{a.style.display="none"},2e3)})}function E(){a.style.display="block",a.innerText="Unsaved changes - make sure to save!",a.style.color="red",document.body.classList.add("body-border-alert")}function _(){document.querySelectorAll(".original-text, .new-text").forEach(e=>{e.removeEventListener("input",E),e.addEventListener("input",E)})}function d(e,n,t){console.log("Adding mapping row to",e);const o=document.createElement("div"),c=document.getElementById("mediaSources"),i=document.getElementById("inAppEvents");if(!c||!i){console.error("Required elements not found in the document");return}o.className="mapping-row",o.innerHTML=`
        <input type="text" class="original-text" placeholder="Original" value="${n}">
        <input type="text" class="new-text" placeholder="Replacement" value="${t}">
        <button class="action-button remove-mapping">&#10005;</button>`,o.querySelector(".remove-mapping").addEventListener("click",()=>{o.remove(),a.style.display="block"}),e==="mediaSources"?c.appendChild(o):e==="inAppEvents"&&i.appendChild(o),_()}function L(){b.forEach(e=>{d("mediaSources",e,"")}),h.forEach(e=>{d("inAppEvents",e,"")})}function A(){document.querySelectorAll(".mapping-row").forEach(e=>{e.remove()}),L(),a.style.display="none"}function w(){console.log("Loading existing mappings"),chrome.storage.sync.get(["mappings"],e=>{const n=e.mappings||[];n.length>0?(console.log("Saved mappings found:",n),n.forEach(t=>{d(t.section,t.original,t.newText)})):(console.log("No saved mappings found. Adding default mappings."),b.forEach(t=>{d("mediaSources",t,"")}),h.forEach(t=>{d("inAppEvents",t,"")}))})}const k={"button-gaming":{iconUrl:"icons/af_icon_red.png",mappings:[{section:"inAppEvents",original:"level_5_achieved",newText:"Gaming Event"}]},"button-ecommerce":{iconUrl:"icons/af_icon_orange.png",mappings:[{section:"inAppEvents",original:"level_5_achieved",newText:"eComm Event"}]},"button-banking":{iconUrl:"icons/af_icon_green.png",mappings:[{section:"inAppEvents",original:"level_5_achieved",newText:"Banking Event"}]},"button-general":{iconUrl:"icons/af_icon_rainbow.png",mappings:[{section:"inAppEvents",original:"level_5_achieved",newText:"General Event"}]}};function B(){console.log("Setting event listeners");const e=document.getElementById("addMediaSource"),n=document.getElementById("addInAppEvent"),t=document.getElementById("save");e.addEventListener("click",()=>d("mediaSources","","")),n.addEventListener("click",()=>d("inAppEvents","","")),t.addEventListener("click",x),f.addEventListener("change",E),g.addEventListener("input",()=>{const s=g.value||"";p(s,!!s),s?(r.innerHTML=`<img src="${s}" class="preview-image">`,r.style.border="2px solid green",r.style.display="block"):(r.innerHTML="",r.style.border="none",r.style.display="none"),a.style.display="block"});function o(s){var m;document.querySelectorAll(".preset-button").forEach(v=>{v.classList.remove("active")});const l=s.currentTarget;l.classList.add("active");const u=k[l.id];if(u){u.iconUrl&&p(u.iconUrl);const v=document.getElementById("inAppEvents");v&&(v.innerHTML=""),(m=u.mappings)==null||m.forEach(y=>{d(y.section,y.original,y.newText)})}}document.querySelectorAll(".preset-button").forEach(s=>{s.addEventListener("click",o)});const i=document.getElementById("button-custom");i&&i.classList.add("active"),document.querySelectorAll(".image-option").forEach(s=>{s.addEventListener("click",()=>{const l=s.getAttribute("src")||"";console.log("Predefined image option clicked:",l),p(l),g.value="",a.style.display="block"})})}const f=document.getElementById("extensionStatusCheckbox");document.addEventListener("DOMContentLoaded",()=>{var t;console.log("DOM fully loaded and parsed");const e=document.getElementById("saveSection"),n=document.getElementById("restoreDefaults");chrome.storage.sync.get(["extensionEnabled"],o=>{o.extensionEnabled===void 0?(chrome.storage.sync.set({extensionEnabled:!0}),f.checked=!0):f.checked=o.extensionEnabled}),n.addEventListener("click",A),(t=e.parentNode)==null||t.insertBefore(a,e),w(),I(),_(),B()});
