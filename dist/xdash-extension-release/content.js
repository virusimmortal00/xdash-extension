function d(){console.log("Creating loading overlay");let e=document.createElement("div"),t=document.createElement("div"),n=document.createElement("div");e.id="my-extension-loading-overlay",e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.backgroundColor="#FFFFFF",e.style.display="flex",e.style.flexDirection="column",e.style.justifyContent="center",e.style.alignItems="center",e.style.zIndex="1000",t.id="my-extension-spinner",t.style.border="8px solid #f3f3f3",t.style.borderTop="8px solid #3498db",t.style.borderRadius="50%",t.style.width="60px",t.style.height="60px",t.style.animation="spin 3s infinite, colorChange 3s infinite",n.id="my-extension-message",n.innerText="xDash Creation In Process",n.style.fontSize="20px",n.style.color="#333333",n.style.fontWeight="bold",n.style.marginTop="20px",n.style.fontFamily="Museo, sans-serif",e.appendChild(t),e.appendChild(n),document.body.appendChild(e);const s=["Life is like a box of chocolates, but with less SKAN.","Grounding up some fresh attribution.","Compiling our deepest darkest secrets.","Mo' ROAS, mo' problems.","I'm sure some of these numbers are right...","Pre-heating the deep links.","Attribution is our favorite kind of 'bution."];for(let o=s.length-1;o>0;o--){const r=Math.floor(Math.random()*(o+1));[s[o],s[r]]=[s[r],s[o]]}let i=0;n.innerText=s[i],setInterval(()=>{i=(i+1)%s.length,n.innerText=s[i]},1500),console.log("Loading overlay created")}function l(){let e=document.getElementById("my-extension-loading-overlay");e?(e.remove(),console.log("Loading overlay removed")):console.log("Loading overlay not found")}function g(){console.log("Attempting to replace images"),chrome.storage.sync.get(["selectedImage"],e=>{let t=e.selectedImage||chrome.runtime.getURL("icons/af_icon_rainbow.png");console.log(`Image to use: ${t}`),t.startsWith("icons/")&&(t=chrome.runtime.getURL(t));const n=window.location.href.includes("onelink")?'[class^="onelink-MuiAvatar-img"]':'[class^="MuiAvatar-img"]',s=document.querySelectorAll(n);let i=0;const o=s.length;if(console.log(`Found ${o} images for replacement with '${t}'`),o===0){l();return}s.forEach((r,a)=>{r.onload=()=>{console.log(`Image ${a} loaded: ${r.src}`),i++,i===o&&(console.log("All images loaded, removing overlay"),l())},r.onerror=()=>{console.log(`Error loading image ${a}`)},r.src=t}),setTimeout(()=>{i!==o&&(console.log("Fallback: Removing overlay"),l())},5e3)})}function c(e){chrome.storage.sync.get(["mappings"],t=>{if(chrome.runtime.lastError){console.error("Extension context has been invalidated.");return}const n=t.mappings;if(n&&e){const s=n.filter(o=>(o.section==="mediaSources"||o.section==="inAppEvents")&&o.newText.trim()!=="").map(o=>({original:o.original,regex:new RegExp(o.original,"gi"),replacement:o.newText}));s.sort((o,r)=>r.original.length-o.original.length);const i=o=>{o.nodeType===Node.TEXT_NODE?s.forEach(r=>{o.textContent=(o.textContent??"").replace(r.regex,r.replacement)}):o.nodeType===Node.ELEMENT_NODE&&o.hasChildNodes()&&o.childNodes.forEach(i)};e.childNodes.forEach(i)}})}function m(){const e=new MutationObserver(function(n){n.forEach(function(s){s.addedNodes.forEach(i=>{i.nodeType===Node.ELEMENT_NODE&&c(i)})})}),t={childList:!0,subtree:!0};e.observe(document.body,t)}function f(){const e=document.createElement("style");e.type="text/css",e.innerText=`
@keyframes spin {
    0% { transform: rotate(0deg); }
    50% { transform: rotate(180deg); }
    100% { transform: rotate(360deg); }
}
@keyframes colorChange {
    0% { border-top-color: #3498db; }
    33% { border-top-color: #e74c3c; }
    66% { border-top-color: #2ecc71; }
    100% { border-top-color: #3498db; }
}`,document.head.appendChild(e)}function u(){chrome.storage.sync.get(["extensionEnabled"],function(e){e.extensionEnabled===!0?(console.log("Extension is enabled. Running main functions..."),y()):console.log("Extension is disabled or not yet configured.")})}function y(){console.log("Running main functions..."),d(),f();let e=window.setInterval(function(){document.querySelector('[class^="MuiAvatar-img"]')&&(console.log("Starting image and text replacement process"),g(),c(document.body),clearInterval(e))},2e3);m()}u();
