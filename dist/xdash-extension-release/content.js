function d(){console.log("Creating loading overlay");let e=document.createElement("div"),t=document.createElement("div"),n=document.createElement("div");e.id="my-extension-loading-overlay",e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.backgroundColor="#FFFFFF",e.style.display="flex",e.style.flexDirection="column",e.style.justifyContent="center",e.style.alignItems="center",e.style.zIndex="1000",t.id="my-extension-spinner",t.style.border="8px solid #f3f3f3",t.style.borderTop="8px solid #3498db",t.style.borderRadius="50%",t.style.width="60px",t.style.height="60px",t.style.animation="spin 3s infinite, colorChange 3s infinite",n.id="my-extension-message",n.innerText="xDash Creation In Process",n.style.fontSize="20px",n.style.color="#333333",n.style.fontWeight="bold",n.style.marginTop="20px",n.style.fontFamily="Museo, sans-serif",e.appendChild(t),e.appendChild(n),document.body.appendChild(e);const r=["Did you know? AppsFlyer has managed over 10,000 global SKAN campaigns, a record in the mobile marketing sector.","Trivia fact: 85% of the world's leading marketers rely on AppsFlyer for their attribution needs.","Daily data processing at AppsFlyer exceeds a billion data points, setting the benchmark in analytics","With a 98% accuracy rate in analytics, AppsFlyer stands out as a leader in precise marketing data","75% of the top apps improve user engagement through AppsFlyer's deep linking technology.","Pre-heating the deep links.","Impressive number: Over 50,000 apps globally choose AppsFlyer for their marketing attribution, leading the industry."];for(let o=r.length-1;o>0;o--){const s=Math.floor(Math.random()*(o+1));[r[o],r[s]]=[r[s],r[o]]}let i=0;n.innerText=r[i],setInterval(()=>{i=(i+1)%r.length,n.innerText=r[i]},1500),console.log("Loading overlay created")}function l(){let e=document.getElementById("my-extension-loading-overlay");e?(e.remove(),console.log("Loading overlay removed")):console.log("Loading overlay not found")}function g(){console.log("Attempting to replace images"),chrome.storage.sync.get(["selectedImage"],e=>{let t=e.selectedImage||chrome.runtime.getURL("icons/af_icon_rainbow.png");console.log(`Image to use: ${t}`),t.startsWith("icons/")&&(t=chrome.runtime.getURL(t));const n=window.location.href.includes("onelink")?'[class^="onelink-MuiAvatar-img"]':'[class^="MuiAvatar-img"]',r=document.querySelectorAll(n);let i=0;const o=r.length;if(console.log(`Found ${o} images for replacement with '${t}'`),o===0){l();return}r.forEach((s,a)=>{s.onload=()=>{console.log(`Image ${a} loaded: ${s.src}`),i++,i===o&&(console.log("All images loaded, removing overlay"),l())},s.onerror=()=>{console.log(`Error loading image ${a}`)},s.src=t}),setTimeout(()=>{i!==o&&(console.log("Fallback: Removing overlay"),l())},5e3)})}function c(e){chrome.storage.sync.get(["mappings"],t=>{if(chrome.runtime.lastError){console.error("Extension context has been invalidated.");return}const n=t.mappings;if(n&&e){const r=n.filter(o=>(o.section==="mediaSources"||o.section==="inAppEvents")&&o.newText.trim()!=="").map(o=>({original:o.original,regex:new RegExp(o.original,"gi"),replacement:o.newText}));r.sort((o,s)=>s.original.length-o.original.length);const i=o=>{o.nodeType===Node.TEXT_NODE?r.forEach(s=>{o.textContent=(o.textContent??"").replace(s.regex,s.replacement)}):o.nodeType===Node.ELEMENT_NODE&&o.hasChildNodes()&&o.childNodes.forEach(i)};e.childNodes.forEach(i)}})}function m(){const e=new MutationObserver(function(n){n.forEach(function(r){r.addedNodes.forEach(i=>{i.nodeType===Node.ELEMENT_NODE&&c(i)})})}),t={childList:!0,subtree:!0};e.observe(document.body,t)}function y(){const e=document.createElement("style");e.type="text/css",e.innerText=`
@keyframes spin {
    0% { transform: rotate(0deg); }
    50% { transform: rotate(180deg); }
    100% { transform: rotate(360deg); }
}
@keyframes colorChange {
    0% { border-top-color: #3498db; }
    33% { border-top-color: #e74c3c; }
    66% { border-top-color: #2ecc71; }
    100% { border-top-color: #3498db; }
}`,document.head.appendChild(e)}function p(){chrome.storage.sync.get(["extensionEnabled"],function(e){e.extensionEnabled===!0?(console.log("Extension is enabled. Running main functions..."),f()):console.log("Extension is disabled or not yet configured.")})}function f(){console.log("Running main functions..."),d(),y();let e=window.setInterval(function(){document.querySelector('[class^="MuiAvatar-img"]')&&(console.log("Starting image and text replacement process"),g(),c(document.body),clearInterval(e))},2e3);m()}p();
