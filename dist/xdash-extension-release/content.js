function d(){console.log("Creating loading overlay");let e=document.createElement("div"),n=document.createElement("div"),t=document.createElement("div");e.id="my-extension-loading-overlay",e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.backgroundColor="#FFFFFF",e.style.display="flex",e.style.flexDirection="column",e.style.justifyContent="center",e.style.alignItems="center",e.style.zIndex="1000",n.id="my-extension-spinner",n.style.border="8px solid #f3f3f3",n.style.borderTop="8px solid #3498db",n.style.borderRadius="50%",n.style.width="60px",n.style.height="60px",n.style.animation="spin 3s infinite, colorChange 3s infinite",t.id="my-extension-message",t.innerText="xDash Creation In Process",t.style.fontSize="20px",t.style.color="#333333",t.style.fontWeight="bold",t.style.marginTop="20px",t.style.fontFamily="Museo, sans-serif",e.appendChild(n),e.appendChild(t),document.body.appendChild(e);const i=["Did you know? AppsFlyer has managed over 10,000 global SKAN campaigns, a record in the mobile marketing sector.","Trivia fact: 85% of the world's leading marketers rely on AppsFlyer for their attribution needs.","Daily data processing at AppsFlyer exceeds a billion data points, setting the benchmark in analytics","With a 98% accuracy rate in analytics, AppsFlyer stands out as a leader in precise marketing data","75% of the top apps improve user engagement through AppsFlyer's deep linking technology.","Marketers using AppsFlyer have seen an average ROAS increase of 30%!","Impressive number: Over 50,000 apps globally choose AppsFlyer for their marketing attribution, leading the industry."];for(let o=i.length-1;o>0;o--){const s=Math.floor(Math.random()*(o+1));[i[o],i[s]]=[i[s],i[o]]}let r=0;t.innerText=i[r],setInterval(()=>{r=(r+1)%i.length,t.innerText=i[r]},1500),console.log("Loading overlay created")}function l(){let e=document.getElementById("my-extension-loading-overlay");e?(e.remove(),console.log("Loading overlay removed")):console.log("Loading overlay not found")}function g(){console.log("Attempting to replace images"),chrome.storage.sync.get(["selectedImage"],e=>{let n=e.selectedImage||chrome.runtime.getURL("icons/af_icon_rainbow.png");console.log(`Image to use: ${n}`),n.startsWith("icons/")&&(n=chrome.runtime.getURL(n));const t=window.location.href.includes("onelink")?'[class^="onelink-MuiAvatar-img"]':'[class^="MuiAvatar-img"]',i=document.querySelectorAll(t);let r=0;const o=i.length;if(console.log(`Found ${o} images for replacement with '${n}'`),o===0){l();return}i.forEach((s,a)=>{s.onload=()=>{console.log(`Image ${a} loaded: ${s.src}`),r++,r===o&&(console.log("All images loaded, removing overlay"),l())},s.onerror=()=>{console.log(`Error loading image ${a}`)},s.src=n}),setTimeout(()=>{r!==o&&(console.log("Fallback: Removing overlay"),l())},5e3)})}function c(e){chrome.storage.sync.get(["mappings"],n=>{if(chrome.runtime.lastError){console.error("Extension context has been invalidated.");return}const t=n.mappings;if(t&&e){let i=t.filter(o=>(o.section==="mediaSources"||o.section==="inAppEvents")&&o.newText.trim()!=="").map(o=>({original:o.original,regex:new RegExp(o.original,"gi"),replacement:o.newText}));i.push({original:"AppsFlyer gaming app",regex:new RegExp("AppsFlyer gaming app","gi"),replacement:"xDash demo app"}),i.sort((o,s)=>s.original.length-o.original.length);const r=o=>{o.nodeType===Node.TEXT_NODE?i.forEach(s=>{const a=o.textContent??"";a.includes(s.original)&&!a.includes(s.replacement)&&(o.textContent=a.replace(s.regex,s.replacement))}):o.nodeType===Node.ELEMENT_NODE&&o.hasChildNodes()&&o.childNodes.forEach(r)};e.childNodes.forEach(r)}})}function m(){const e=new MutationObserver(function(t){t.forEach(function(i){i.addedNodes.forEach(r=>{r.nodeType===Node.ELEMENT_NODE&&c(r)})})}),n={childList:!0,subtree:!0};e.observe(document.body,n)}function p(){const e=document.createElement("style");e.type="text/css",e.innerText=`
@keyframes spin {
    0% { transform: rotate(0deg); }
    50% { transform: rotate(180deg); }
    100% { transform: rotate(360deg); }
}
@keyframes colorChange {
    0% { border-top-color: #3498db; }
    33% { border-top-color: #e74c3c; }
    66% { border-top-color: #2ecc71; }
    100% { border-top-color: #3498db; }
}`,document.head.appendChild(e)}function y(){chrome.runtime.sendMessage({action:"getExtensionState"},function(e){e.extensionEnabled===!0?(console.log("Extension is enabled. Running main functions..."),u()):console.log("Extension is disabled or not yet configured.")})}function u(){const e=window.location.href;if(!e.includes("com.appsflyer.android.demo.app.gaming")&&!e.includes("id1510243350"))return;console.log("Running main functions..."),d(),p();let n=window.setInterval(function(){document.querySelector('[class^="MuiAvatar-img"]')&&(console.log("Starting image and text replacement process"),g(),c(document.body),clearInterval(n))},2e3);m()}y();
